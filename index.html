<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>PvP Profile</title>

  <!-- Telegram API -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(160deg, #1e1e2f, #2c2c44);
      color: white;
      text-align: center;
    }

    .card {
      max-width: 360px;
      margin: 40px auto;
      padding: 20px;
      background: #2a2a40;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(0,0,0,.6);
    }

    .avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: #444;
      margin: 0 auto 10px;
    }

    .stat {
      margin: 8px 0;
      font-size: 18px;
    }

    button {
      margin-top: 15px;
      padding: 12px 20px;
      background: #ff9800;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div class="card">
    <div class="avatar"></div>
    <h2 id="name">–ò–≥—Ä–æ–∫</h2>

    <div class="stat">üí™ –°–∏–ª–∞: <span id="str"></span></div>
    <div class="stat">‚ö° –õ–æ–≤–∫–æ—Å—Ç—å: <span id="agi"></span></div>
    <div class="stat">‚ù§Ô∏è –í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å: <span id="sta"></span></div>
    <div class="stat">üí∞ –ú–æ–Ω–µ—Ç—ã: <span id="coins"></span></div>

<!-- –ö–ù–û–ü–ö–ò –ò–ì–†–´ -->
  <button onclick="startFight()">üó° –í –±–æ–π</button>
  <button onclick="upgrade('strength')">üí™ –°–∏–ª–∞ +</button>
  <button onclick="upgrade('agility')">‚ö° –õ–æ–≤–∫–æ—Å—Ç—å +</button>
  <button onclick="upgrade('stamina')">‚ù§Ô∏è –í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å +</button>

    <button onclick="Telegram.WebApp.close()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <script>
    const tg = Telegram.WebApp;
    tg.ready();

  const userId = tg.initDataUnsafe.user.id;

function loadProfile() {
  fetch("https://89.111.134.240:8000/profile", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({telegram_id: userId})
  })
  .then(r => r.json())
  .then(d => {
    str.innerText = d.strength;
    agi.innerText = d.agility;
    sta.innerText = d.stamina;
    coins.innerText = d.coins;
  });
}

function startFight() {
  fetch("https://89.111.134.240:8000/fight", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({telegram_id: userId})
  })
  .then(r => r.json())
  .then(d => {
    if (d.status === "wait") {
      alert("–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...");
    } else {
      alert("–ë–æ–π –æ–∫–æ–Ω—á–µ–Ω!\n" + d.log.join("\n"));
      loadProfile();
    }
  });
}

function upgrade(stat) {
  fetch("https://89.111.134.240:8000/upgrade", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({telegram_id: userId, stat: stat})
  })
  .then(() => loadProfile());
}

loadProfile();
</script>
</body>
</html>
